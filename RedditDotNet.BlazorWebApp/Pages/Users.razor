@using RedditDotNet.Models.Parameters

@page "/u/{userName}"
@page "/u/{userName}/{listingType}"
@page "/user/{userName}"
@page "/user/{userName}/{listingType}"

@if (!ProfileLoaded)
{
    <Heading Size="HeadingSize.Is2">@UserName</Heading>
    <Paragraph>Loading profile...</Paragraph>
}
else
{
    <UserCard AccountData="@Account.Data" />
    <TrophiesCard Trophies="@Trophies" />
    @if (IsSelf)
    {
        <KarmaBreakdownCard AccountKarmaBreakdown="@KarmaBreakdown" />
    }
}

<hr />
<Row>
    <Column ColumnSize="ColumnSize.IsAuto">
        <UserProfileNavTabs UserName="@UserName"
                            ActiveTab="@GetListingType()"
                            IsSelf="@IsSelf" />
    </Column>
    @switch (GetListingType())
    {
        case UserProfileListingType.Overview:
        case UserProfileListingType.Comments:
        case UserProfileListingType.Submitted:
        case UserProfileListingType.Gilded:
            <Column ColumnSize="ColumnSize.IsAuto">
                <Select Margin="Margin.Is2.FromBottom" Width="Width.Auto"
                Background="App.Background" TextColor="App.TextColor"
                Border="Border.Secondary"
                @bind-SelectedValue="Sort" @onchange="SortSelect_OnChange">
                    <SelectItem Value="@("hot")">Hot</SelectItem>
                    <SelectItem Value="@("new")">New</SelectItem>
                    <SelectItem Value="@("top")">Top</SelectItem>
                    <SelectItem Value="@("controversial")">Controversial</SelectItem>
                </Select>
            </Column>
            @if ((Sort?.Equals("top") ?? false) || (Sort?.Equals("controversial") ?? false))
            {
                <Column ColumnSize="ColumnSize.IsAuto">
                    <Select Margin="Margin.Is2.FromBottom" Width="Width.Auto"
                Background="App.Background" TextColor="App.TextColor"
                Border="Border.Secondary"
                @bind-SelectedValue="Timescale" @onchange="TimescaleSelect_OnChange">
                        <SelectItem Value="@("hour")">Hour</SelectItem>
                        <SelectItem Value="@("day")">Day</SelectItem>
                        <SelectItem Value="@("week")">Week</SelectItem>
                        <SelectItem Value="@("month")">Month</SelectItem>
                        <SelectItem Value="@("year")">Year</SelectItem>
                        <SelectItem Value="@("all")">All</SelectItem>
                    </Select>
                </Column>
            }
            break;
        default:
            break;
    }
</Row>
@if (!ListingLoaded)
{
    <Paragraph>@GetLoadingQuip()</Paragraph>
}
else
{
    <LinkOrCommentList Listing="@LinksOrComments" />
    <ListingPagination After="@LinksOrComments?.Data?.After"
                   Before="@LinksOrComments?.Data?.Before"
                   CurrentPageParameters="@BuildParameters()"
                   RelativeUrl="@GetRelativeUrl()" />
}